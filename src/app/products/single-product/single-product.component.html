<span class="loadingInfo"></span>
<p>
  <a routerLink="../products/product-manager" *ngIf="productManagerId !== 0">
    < Back to My products
  </a>
</p>

<div *ngIf="productsLoader == true">
  <p>Fetching details for {{ sku }}...</p>
  <mat-progress-bar color="accent" mode="indeterminate"></mat-progress-bar>
</div>

<div *ngIf="product">
  <p>
    <a routerLink="/">Products </a> / Product Details / {{ productName }} 
    <span style="float: right; cursor: pointer;" (click)="toggleInfoBar()">
      <i *ngIf="showInfoBar" class="material-icons">arrow_right</i>
      <i *ngIf="!showInfoBar" class="material-icons">arrow_left</i>
    </span>
  </p>

  <div class="row" id="pdfContent">
    <div [class]="mainTabsCls" style="transition: width 1s;">
      <mat-card style="background: #EFEFEF;">
        
        <mat-tab-group>
          <mat-tab label="Product Details" *ngIf="canManageThisProduct">

            <div class="mt-3" style="overflow: hidden !important;">
              <div style="margin-bottom: 1rem; padding-left: 10px; color: #545454;">
                <span *ngFor="let cat of productCategories">
                  {{ cat.name }} <span *ngIf="cat.name != ''"> / </span>
                </span>
              </div>
               
              <div class="row">
                <div class="col-md-5">
                  <mat-card>
                    <form [formGroup]="productForm">

                      <img src="../../../assets/icons/details.png" height="30" class="mx-2"> <strong> General Details</strong><hr> 
                      <mat-form-field *ngIf="adminRole" appearance="outline" style="width: 90%;">
                        <mat-label>ID</mat-label>
                        <input #id matInput formControlName="id">
                      </mat-form-field>
                      <mat-form-field appearance="outline" style="width: 90%;">
                        <mat-label>SKU</mat-label>
                        <input #sku matInput formControlName="sku" placeholder="Enter Product SKU">
                      </mat-form-field>
                      <mat-form-field appearance="outline" style="width: 90%;">
                        <mat-label>Product Name</mat-label>
                        <input #name matInput formControlName="name" placeholder="Enter Product Name" [readonly]="!editRole">
                      </mat-form-field>
                      <mat-form-field appearance="outline" style="width: 90%;">
                        <mat-label>Product Brand</mat-label>
                        <mat-select #brand matInput formControlName="brand_type_id">
                          <mat-option *ngFor="let type of typesList | typeGroup : 'Brand'" value="{{ type.id }}" [disabled]="!editRole">{{ type.name }}</mat-option>
                        </mat-select>
                      </mat-form-field>
                      <mat-form-field appearance="outline" style="width: 90%;">
                        <mat-label>Series</mat-label>
                        <input #family_grouping matInput [formControl]="autocompleteControl1" [matAutocomplete]="auto" placeholder="Enter Series" value="{{ productSeries }}" [(ngModel)]="newSeriesType" [readonly]="!editRole">
                        <mat-autocomplete (optionSelected)="addSeries($event)" #auto="matAutocomplete">
                          <mat-option *ngFor="let option of filteredSeries | async" [value]="option">
                            {{option}}
                          </mat-option>
                        </mat-autocomplete>
                        <!-- <mat-icon class="save-icon" matSuffix matTooltip="Save series" (click)="addNonExistingType()">check_circle_outline</mat-icon> -->
                      </mat-form-field>
                      <strong>Description</strong><br><br>
                      <mat-form-field style="width: 90%;" appearance="outline">
                        <mat-label>Short Description</mat-label>
                        <textarea #short_description rows="7" matInput formControlName="short_description" placeholder="Enter short product description" [readonly]="!editRole"></textarea>
                      </mat-form-field>
                      <mat-form-field style="width: 90%;" appearance="outline">
                        <mat-label>Description</mat-label>
                        <textarea #description rows="15" matInput formControlName="description" placeholder="Enter product description..." [readonly]="!editRole"></textarea>
                      </mat-form-field>
                      <br>
                      <div style="padding-left: 1rem;">
                        <mat-checkbox #is_in_development formControlName="is_in_development" [disabled]="!editRole">Is In Development</mat-checkbox><br>
                        <mat-checkbox #is_eol formControlName="is_eol" [disabled]="!editRole">Is EOL</mat-checkbox><br>
                        <mat-checkbox #is_active formControlName="is_active" [disabled]="!editRole">Is Active</mat-checkbox><hr>
                        <mat-checkbox #requires_icasa formControlName="requires_icasa" [disabled]="!editRole">Requires Icasa</mat-checkbox><hr>
                        <!-- <mat-checkbox [disabled]="productManagerId == 0 || !canVerify" #verified formControlName="verified">Verified</mat-checkbox><br> -->
                        <div *ngIf="!imagesAreSorted" class="card warning">
                          ⚠ Before verifying, make sure your images are arranged correctly on the "Media" tab.
                        </div>
                        <div *ngIf="productCategories.length < 1" class="card warning">
                          ⚠ Please set categories for this product
                        </div>
                        <mat-checkbox [disabled]="!canVerify" #verified formControlName="verified">Verified</mat-checkbox><br>
                        <span *ngIf="productManagerId == 0"><i class="text-muted">Product Manager is needed to verify this product</i></span>
                        <hr>
                        <button mat-raised-button [disabled]="!productForm.dirty" *ngIf="editRole" type="submit" color="primary" (click)="updateProduct()">Save Changes</button>
                      </div>
                    </form>
                  </mat-card>
                  <br>
                  <mat-card>
                    <img src="../../../assets/icons/regions.png" height="25" class="mx-2"> <strong>Regions </strong><span class="loadingInfo"></span><hr>            
                    <form [formGroup]="regionsForm">
                      <ng-container formArrayName="regions">
                        <ng-container *ngFor="let x of regions.controls; let index = index">
                            <div [formGroupName]="index">
                              <mat-form-field appearance="outline" style="width: 90%;">
                                <mat-label>Product Region</mat-label>
                                <mat-select #regionField matInput formControlName="regionField">
                                  <mat-option *ngFor="let type of typesList | typeGroup : 'Region'" value="{{ type.id }}" [disabled]="!editRole">{{ type.name }}</mat-option>
                                </mat-select>
                              </mat-form-field>            
                            </div>
                        </ng-container>
                      </ng-container>
                      <button mat-raised-button type="button" (click)="addRegion()" style="margin-left: 1rem;" *ngIf="editRole">
                        Add Region
                      </button>
                      <button mat-raised-button type="submit" *ngIf="editRole" [disabled]="!regionsForm.dirty" color="primary" (click)="updateRegion()" style="margin-left: 1rem;">Save Region</button>
                    </form>
                  </mat-card>

                  <mat-card *ngFor="let type of typesList | typeGroup : 'Design'" style="margin-top: 1rem;">
                    <img src="../../../assets/icons/{{type.name}}.png" height="30" class="mx-2"> <strong> {{type.name}} </strong><hr>  
                    <form *ngIf="type.id == 80" [formGroup]="shoutoutsForm">
                      <ng-container formArrayName="shoutouts">
                        <ng-container *ngFor="let x of shoutouts.controls; let index = index">
                            <div [formGroupName]="index">
                              <mat-form-field appearance="outline" style="width: 90%;">
                                <mat-label>{{ type.name }}:</mat-label>
                                <textarea rows="6" matInput #designField formControlName="designField" placeholder="" [readonly]="!editRole" required></textarea>
                                <mat-icon *ngIf="editRole" matSuffix (click)="removeDesign(index, type.id)">delete</mat-icon>
                              </mat-form-field>              
                            </div>
                        </ng-container>
                      </ng-container>
                      <button *ngIf="editRole" mat-raised-button type="button" (click)="addDesign(type.id)" style="margin-left: 1rem;">
                        Add New
                      </button>
                      <button mat-raised-button type="submit" *ngIf="editRole" color="primary" (click)="design(type.id)" style="margin-left: 1rem; float: right;" [disabled]="designLoader">Save</button>
                    </form>

                    <form *ngIf="type.id == 81" [formGroup]="featuresAndBenefitsForm">
                      <ng-container formArrayName="features">
                        <ng-container *ngFor="let x of features.controls; let index = index">
                            <div [formGroupName]="index">
                              <mat-form-field appearance="outline" style="width: 90%;">
                                <mat-label>{{ type.name }}:</mat-label>
                                <textarea rows="6" matInput formControlName="designField" placeholder="" [readonly]="!editRole" required></textarea>
                                <mat-icon matSuffix *ngIf="editRole" (click)="removeDesign(index, type.id)">delete</mat-icon>
                              </mat-form-field>              
                            </div>
                        </ng-container>
                      </ng-container>
                      <button *ngIf="editRole" mat-raised-button type="button" (click)="addDesign(type.id)" style="margin-left: 1rem;">
                        Add New
                      </button>
                      <button mat-raised-button type="submit" *ngIf="editRole" color="primary" (click)="design(type.id)" style="margin-left: 1rem; float: right;" [disabled]="designLoader">Save</button>
                    </form>

                    <form *ngIf="type.id == 82" [formGroup]="extendedFabsForm">
                      <ng-container formArrayName="fabs">
                        <ng-container *ngFor="let x of fabs.controls; let index = index">
                            <div [formGroupName]="index">
                              <mat-form-field appearance="outline" style="width: 90%;">
                                <mat-label>{{ type.name }}:</mat-label>
                                <textarea rows="6" matInput formControlName="designField" placeholder="" [readonly]="!editRole" required></textarea>
                                <mat-icon *ngIf="editRole" matSuffix (click)="removeDesign(index, type.id)">delete</mat-icon>
                              </mat-form-field>              
                            </div>
                        </ng-container>
                      </ng-container>
                      <button *ngIf="editRole" mat-raised-button type="button" (click)="addDesign(type.id)" style="margin-left: 1rem;">
                        Add New
                      </button>
                      <button mat-raised-button type="submit" *ngIf="editRole" color="primary" (click)="design(type.id)" style="margin-left: 1rem; float: right;" [disabled]="designLoader">Save</button>
                    </form>

                    <form *ngIf="type.id == 83" [formGroup]="packageContentsForm">
                      <ng-container formArrayName="contents">
                        <ng-container *ngFor="let x of contents.controls; let index = index">
                            <div [formGroupName]="index">
                              <mat-form-field appearance="outline" style="width: 90%;">
                                <mat-label>{{ type.name }}:</mat-label>
                                <input matInput type="text" formControlName="designField" placeholder="" [readonly]="!editRole" required>
                                <mat-icon *ngIf="editRole" matSuffix (click)="removeDesign(index, type.id)">delete</mat-icon>
                              </mat-form-field>              
                            </div>
                        </ng-container>
                      </ng-container>
                      <button *ngIf="editRole" mat-raised-button type="button" (click)="addDesign(type.id)" style="margin-left: 1rem;">
                        Add New
                      </button>
                      <button mat-raised-button type="submit" *ngIf="editRole" color="primary" (click)="design(type.id)" style="margin-left: 1rem; float: right;" [disabled]="designLoader">Save</button>
                    </form>
                  </mat-card>
                </div>
            
                <div class="col-md-7">
                  <mat-card *ngIf="isBundle" style="margin-top: 2rem;">
                    <img src="../../../assets/icons/linked.png" height="30" class="mx-2"> <strong> Linked Products</strong><hr> 
                    <mat-progress-bar color="accent" *ngIf="bundleLoader" mode="indeterminate"></mat-progress-bar>
                    <br><br>
                    <mat-form-field appearance="outline" *ngFor="let sku of linkedProductSKUs" style="margin-bottom: 1rem; width: 50%;">
                      <input type="text" placeholder="Search SKU" aria-label="Number" matInput value="{{sku}}" readonly>
                      <mat-icon *ngIf="editRole" matSuffix (click)="removeFromBundle(sku)" style="color:#545454;">delete</mat-icon>
                      <mat-hint><a target="_blank" href="https://products.smdtechnologies.com/{{sku}}">View this product</a></mat-hint>
                    </mat-form-field>

                    <form [formGroup]="newProductForm">
                      <mat-form-field appearance="outline" *ngFor="let sku of newPamphletSKUs" style="margin-bottom: 1rem; width: 50%;">
                        <mat-label>Selected Product</mat-label>
                        <input type="text" placeholder="Search SKU" aria-label="Number" matInput value="{{sku}}" readonly>
                        <mat-icon matSuffix (click)="removeFromBundle(sku)">delete</mat-icon>
                        <mat-hint><a target="_blank" href="https://products.smdtechnologies.com/{{sku}}">View this product</a></mat-hint>
                      </mat-form-field>

                      <mat-form-field appearance="outline" style="margin-bottom: 1rem; width: 50%;">
                        <mat-label>Add Product</mat-label>
                        <input type="text" placeholder="Enter SKU" aria-label="Number" matInput [formControl]="autocompleteControl" [matAutocomplete]="auto">
                        <mat-autocomplete (optionSelected)="addToBundle($event)" #auto="matAutocomplete">
                          <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                            {{option}}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>
                      <!-- <button type="submit" style="float: right;" mat-raised-button type="submit" color="primary" (click)="saveBundleProduct('Pamphlet')">Save Changes</button> -->
                    </form>

                  </mat-card>

                  <mat-card style="height: auto;">
                    <img src="../../../assets/icons/gallery.png" height="30" class="mx-2"> <strong> Images</strong><hr> 
                    <mat-progress-bar color="accent" *ngIf="loadingPdsAttributes" mode="indeterminate"></mat-progress-bar>
                    <br><br>
                    <div class="row">
                      <!-- system images -->
                      <div class="col-md-3 p-3" *ngFor="let image of mediaFiles; let index = index">
                        <div class="flip-card">
                          <div class="flip-card-inner">
                            <div class="flip-card-front">
                              <p style="color: white;">...</p>
                              <img mat-card-image src="{{ storageUrl + filePath(image.path) }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'">
                            </div>
                            <div class="flip-card-back">
                              <mat-chip-list aria-label="Fish selection">
                                <mat-chip class="mat-chip-list" *ngFor="let type of typesList | typeGroup : 'Image Type'"  (click)="downloadURI('storage/' + filePath(image.path), type.id, image.name, image)">{{ type.name }}</mat-chip>
                              </mat-chip-list>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row" *ngFor="let images of mediaFilesForLinkedProducts;">
                      <!-- system images Linked Products-->
                      <div class="col-md-3 p-3" *ngFor="let image of images; let index = index">
                        <div class="flip-card">
                          <div class="flip-card-inner">
                            <div class="flip-card-front">
                              <p style="color: white;">...</p>
                              <img mat-card-image src="{{ storageUrl + filePath(image.path) }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'">
                            </div>
                            <div class="flip-card-back">
                              <mat-chip-list aria-label="Fish selection">
                                <mat-chip class="mat-chip-list" *ngFor="let type of typesList | typeGroup : 'Image Type'"  (click)="downloadURI('storage/' + filePath(image.path), type.id, image.name, image)">{{ type.name }}</mat-chip>
                              </mat-chip-list>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </mat-card>

                  <!-- <mat-card style="margin-top: 30px !important; height: auto;">
                    <img src="../../../assets/icons/gallery.png" height="30" class="mx-2"> <strong>More Images</strong><hr> 
                    <div class="row">
                      <div class="col-md-3  p-3" *ngFor="let image of imageServerFiles;">
                        <div class="flip-card">
                          <div class="flip-card-inner">
                            <div class="flip-card-front">
                              <p style="font-size:x-small; background-color:rgb(235, 235, 235); color:rgb(165, 165, 165); padding-left: 6px;">Image Server</p>
                              <img mat-card-image src="https://images.smdtechnologies.co.za/uploads/{{image}}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" width="100" >
                            </div>
                            <div class="flip-card-back">
                              <mat-chip-list aria-label="Fish selection">
                                <mat-chip class="mat-chip-list" *ngFor="let type of typesList | typeGroup : 'Image Type'" (click)="downloadImageServer('https://images.smdtechnologies.co.za/uploads/' + image, type.id, image.filename, image)">{{ type.name }}</mat-chip>
                              </mat-chip-list>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </mat-card> -->

                  <mat-card style="margin-top: 30px !important; height: auto;">
                    <img src="../../../assets/icons/attributes.png" height="30" class="mx-2"> <strong>Attributes</strong><hr> 
                    <mat-progress-bar color="accent" *ngIf="loadingPdsAttributes" mode="indeterminate"></mat-progress-bar>
                    <br>
                    <div *ngIf="!loadingPdsAttributes">
                      <ul class="attributes-bullets">
                        <li *ngFor="let i of productAttributes">
                          <span *ngIf="i.key">• {{ i.key }}: </span>
                          <span [innerHTML]="beautifyAttr(i.value)"></span>
                          
                        </li>
                      </ul>
                    </div>
                  </mat-card>

                  <mat-card style="margin-top: 30px !important; height: auto;">
                    <img src="../../../assets/icons/attributes.png" height="30" class="mx-2"> <strong> PDS Attributes</strong><hr> 
                    <mat-progress-bar color="accent" *ngIf="loadingPdsAttributes" mode="indeterminate"></mat-progress-bar>
                    <br>
                    <div *ngIf="!loadingPdsAttributes">
                      <table class="table table-bordered">
                        <tr *ngFor="let i of pdsAttributes">
                          <td>{{ i.attribute_key }}</td>
                          <td>{{ i.attribute_value }}</td>
                        </tr>
                      </table>
                    </div>
                  </mat-card>
                                        
                </div>
              </div>
            </div>
            
          </mat-tab>
          <mat-tab label="Manage Categories" *ngIf="canManageThisProduct">
            <div class="mt-5 custom-tab" style="overflow: hidden !important;">
              <mat-card style="background-color: rgb(255, 255, 255);">
                <form>
                  <div class="row form-border">
                    <div class="col-md-6">
                      <span *ngFor="let cat of productCategories">
                        {{ cat.name }} <span *ngIf="cat.name != ''"> / </span>
                      </span>
                      <hr>
                      <button *ngIf="productCategories.length > 0" mat-stroked-button (click)="clearCats()" style="font-size: smaller; color: red;"><mat-icon>delete</mat-icon> Clear Categories</button>&nbsp;
                      <button *ngIf="!modifyingCategories" mat-stroked-button (click)="modifyCats()" style="font-size: smaller;"><mat-icon>edit</mat-icon>Edit Categories</button>
                      <button *ngIf="modifyingCategories" mat-stroked-button (click)="modifyCats()" style="font-size: smaller;"><mat-icon>cancel</mat-icon>Cancel</button>
                      <br /><br />

                      <div *ngIf="modifyingCategories">
                        <mat-form-field appearance="outline" style="width: 90%;">
                          <mat-label>Primary Category</mat-label>
                          <mat-select [(value)]="tier1" (selectionChange)="chosenItem($event, 1)">
                            <mat-option *ngFor="let category of primaryCategoriesList" [value]="category.id">{{ category.name }}</mat-option>
                          </mat-select>
                        </mat-form-field>
  
                        <mat-form-field *ngIf="tier1 > 0" appearance="outline" style="width: 90%;">
                          <mat-label>{{ tierLabels[1] }}</mat-label>
                          <mat-select [(value)]="tier2" (selectionChange)="chosenItem($event, 2)">
                            <mat-option *ngFor="let category of descedantsCategories" [value]="category.id">{{ category.name }}</mat-option>
                          </mat-select>
                        </mat-form-field>
  
                        <mat-form-field *ngIf="tier2 > 0" appearance="outline" style="width: 90%;">
                          <mat-label>{{ tierLabels[2] }}</mat-label>
                          <mat-select [(value)]="tier3" (selectionChange)="chosenItem($event,3)">
                            <mat-option *ngFor="let category of descedantsCategories" [value]="category.id">{{ category.name }}</mat-option>
                          </mat-select>
                        </mat-form-field>
  
                        <mat-form-field *ngIf="tier3 > 0" appearance="outline" style="width: 90%;">
                          <mat-label>{{ tierLabels[3] }}</mat-label>
                          <mat-select [(value)]="tier4" (selectionChange)="chosenItem($event,4)">
                            <mat-option *ngFor="let category of descedantsCategories" [value]="category.id">{{ category.name }}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>

                      <div class="col-md-row">
                        <div class="col-md-2">
                          <!-- <button *ngIf="modifyingCategories" mat-raised-button type="submit" color="primary" (click)="saveCategories()" >Save Changes</button> -->
                          <button mat-raised-button type="submit" color="primary" (click)="saveCategories()" >Save Changes</button>
                        </div>

                      </div>
                    </div>
                    <div class="col-md-6" style="background-color: aliceblue;">
                      <small *ngIf="!checkboxLoader"><i>Ctrl + F</i> to find category</small>
                      <small *ngIf="checkboxLoader"><i>Please wait...</i></small>
                      <hr>
                      <div style="height: 40rem; overflow-y: scroll;">
                        <ul>
                          <li *ngFor="let category of categoriesList | parent: '0'" ><mat-checkbox (change)="checkedItem(category.id, category.parent, $event)" [checked]="isChecked(category.id)" [disabled]="isChecked(category.id)"></mat-checkbox> <strong> {{ category.name }}</strong>
                            <ul class="category-chechbox">
                              <li *ngFor="let child_1 of categoriesList | parent: category.id"><mat-checkbox (change)="checkedItem(child_1.id, child_1.parent, $event)" [checked]="isChecked(child_1.id)" [disabled]="isChecked(child_1.id)"></mat-checkbox> {{ child_1.name }}
                                <ul class="category-chechbox">
                                  <li *ngFor="let child_2 of categoriesList | parent: child_1.id"><mat-checkbox (change)="checkedItem(child_2.id, child_2.parent, $event)" [checked]="isChecked(child_2.id)" [disabled]="isChecked(child_2.id)"></mat-checkbox> {{ child_2.name }}
                                    <ul class="category-chechbox">
                                        <li *ngFor="let child_3 of categoriesList | parent: child_2.id"><mat-checkbox (change)="checkedItem(child_3.id, child_3.parent, $event)" [checked]="isChecked(child_3.id)" [disabled]="isChecked(child_3.id)"></mat-checkbox> {{ child_3.name }}
                                          <ul class="category-chechbox">
                                            <li *ngFor="let child_4 of categoriesList | parent: child_3.id"><mat-checkbox (change)="checkedItem(child_4.id, child_4.parent, $event)" [checked]="isChecked(child_4.id)" [disabled]="isChecked(child_4.id)"></mat-checkbox> {{ child_4.name }}
                                              <ul class="category-chechbox">
                                                <li *ngFor="let child_5 of categoriesList | parent: child_4.id"><mat-checkbox (change)="checkedItem(child_5.id, child_5.parent, $event)" [checked]="isChecked(child_5.id)" [disabled]="isChecked(child_5.id)"></mat-checkbox> {{ child_5.name }}
                                                  <ul class="category-chechbox">
                                                    <li *ngFor="let child_6 of categoriesList | parent: child_5.id"><mat-checkbox (change)="checkedItem(child_6.id, child_6.parent, $event)" [checked]="isChecked(child_6.id)" [disabled]="isChecked(child_6.id)"></mat-checkbox> {{ child_6.name }}</li>
                                                  </ul>
                                                </li>
                                              </ul>
                                            </li>
                                          </ul>
                                        </li>
                                      </ul>
                                    </li>
                                  </ul>
                                </li>
                              </ul>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </form>
              </mat-card>
            </div>
          </mat-tab>
          <mat-tab label="Manage Attributes" *ngIf="canManageThisProduct">

            <div class="mt-2 custom-tab form-border" style="overflow: hidden !important;">
              <mat-card style="background-color: rgb(255, 255, 255);">
                <h2>Manually add Attributes</h2>
                <form [formGroup]="productFormAttributes">
                  <ng-container formArrayName="attributes">
                    <ng-container *ngFor="let x of attributes.controls; let index = index">
                        <div [formGroupName]="index">
                            <mat-grid-list cols="3" rowHeight="80px">
                                <mat-grid-tile>
                                    <mat-form-field appearance="outline" style="width: 100%;">
                                        <input matInput id="attrName" type="text" formControlName="attrName" placeholder="Enter Value" [readonly]="!editRole">
                                    </mat-form-field>
                                </mat-grid-tile>
                                <mat-grid-tile>
                                    <mat-form-field appearance="outline" style="width: 100%;">
                                        <input type="text" matInput id="attrValue" formControlName="attrValue" placeholder="Enter Value" [readonly]="!editRole">
                                    </mat-form-field>
                                </mat-grid-tile>
                                <mat-grid-tile>
                                    <button class="mb-3" mat-raised-button type="button" (click)="removeNewAttribute(index)" color="warn"><mat-icon>delete</mat-icon> Remove This Field</button>
                                </mat-grid-tile>
                            </mat-grid-list>                
                        </div>
                    </ng-container>
                  </ng-container>
                  <button mat-raised-button type="button" *ngIf="editRole" color="accent" (click)="addNewAttribute()" style="margin-left: 1rem;">
                    <mat-icon>add_circle_outline</mat-icon>
                    Add Attribute
                  </button>
                  <button mat-raised-button type="submit" *ngIf="editRole" [disabled]="!productFormAttributes.dirty" color="primary" (click)="updateAttributes()" style="float: right; ">{{saveAttrBtnText}}</button>
                </form>
              </mat-card>

              <mat-card style="background-color: rgb(255, 255, 255); margin-top: 1rem;">
                <h2>Paste Attributes</h2>
                <form [formGroup]="productFormAttributesBulk">
                  <input formControlName="attrName" type="hidden" value="6">
                  <textarea formControlName="attrValue" rows="6" placeholder="Paste attributes here" [readonly]="!editRole" style="width: 100%;"></textarea>
                  <button mat-raised-button type="submit" *ngIf="editRole" color="primary" (click)="updateAttributesBulk()" style="margin-left: 1rem; ">{{saveAttrBtnText}}</button>
                </form>
              </mat-card>

              <mat-card style="background-color: rgb(255, 255, 255); margin-top: 1rem;">

                <ul class="attributes-bullets">
                  <li *ngFor="let i of productAttributes">
                    <span *ngIf="i.key">• {{ i.key }}: </span> 
                    <span [innerHTML]="beautifyAttr(i.value)"></span>
                    <span *ngIf="editRole" style="width: 7px;">
                      <button mat-button [matMenuTriggerFor]="menu" aria-label="Options">
                        <mat-icon>more_vert</mat-icon>
                      </button>
                      <mat-menu #menu="matMenu">
                        <button mat-menu-item *ngIf="editRole" (click)="deleteProductAttribute(i.id, i.key, i.product_id)">
                          <mat-icon color="warn">delete</mat-icon>
                          <span>Delete</span>
                        </button>
                      </mat-menu>
                    </span>
                  </li>
                </ul>
              
              </mat-card>
            </div>
          </mat-tab>
          <mat-tab label="Packaging" *ngIf="canManageThisProduct">

            <mat-card style="background-color: rgb(255, 255, 255);">

              <h2>Packaging Information</h2>
              <span *ngIf="packagingCount < 0" class="warning">No information to show</span>
              <mat-progress-bar *ngIf="packagingLoader" color="accent" mode="indeterminate"></mat-progress-bar>
              
                <table class="table table-bordered mt-2">
                  <tr>
                    <th>Type</th>
                    <th>Length</th>
                    <th>Height</th>
                    <th>Width</th>
                    <th>Weight</th>
                    <th>Barcode</th>
                  </tr>
                  <tr *ngFor="let i of packaging">
                    <td>{{ returnTypeName(i.packaging_type_id) }}</td>
                    <td><input id="length{{i.id}}" matInput placeholder="Length" [value]="i.length" [readonly]="!editRole"></td>
                    <td><input id="height{{i.id}}" matInput placeholder="Height" [value]="i.height"  [readonly]="!editRole"></td>
                    <td><input id="width{{i.id}}" matInput placeholder="Width" [value]="i.width" [readonly]="!editRole"></td>
                    <td><input id="weight{{i.id}}" matInput placeholder="Weight" [value]="i.weight" [readonly]="!editRole"></td>
                    <td><input id="barcode{{i.id}}" matInput placeholder="Barcode" [value]="i.barcode" [readonly]="!editRole"></td>
                    <td *ngIf="editRole" style="width: 7px;">
                      <span *ngIf="editRole" style="width: 7px;">
                        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Options">
                          <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                          <button mat-menu-item *ngIf="editRole" (click)="savePackagingChanges(i.id)">
                            <mat-icon color="primary">save</mat-icon>
                            <span>Save</span>
                          </button>
                          <button mat-menu-item *ngIf="editRole" (click)="deletePackaging(i.id)">
                            <mat-icon color="warn">delete</mat-icon>
                            <span>Delete</span>
                          </button>
                        </mat-menu>
                      </span>
                    </td>
                  </tr>
                </table>
            </mat-card>
            <mat-card style="background-color: rgb(255, 255, 255); margin-top: 1rem;">
              <h2>Add New Packaging Information</h2>
              <form [formGroup]="productFormPackaging">
                <div class="mt-2 custom-tab" style="overflow: hidden !important;">
                  <div class="row form-border">
                    <div class="col-md-6">
                      <mat-form-field appearance="outline">
                        <mat-label>Choose Packaging Type:</mat-label>
                        <mat-select name="packaging_type_id" formControlName="packaging_type_id" [disabled]="!editRole">
                            <mat-option [value]="type.id" *ngFor="let type of typesList | typeGroup : 'Packaging'">
                                {{ type.name }}
                            </mat-option>
                        </mat-select>
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>Weight (KG)</mat-label>
                        <input matInput formControlName="weight" placeholder="Enter Product Weight" [readonly]="!editRole">
                        <mat-icon matSuffix>fitness_center</mat-icon>
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>Dimensions(cm): Length</mat-label>
                        <input matInput formControlName="length" placeholder="Enter Product Length" [readonly]="!editRole">
                        <mat-icon matSuffix>design_services</mat-icon>
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>Dimensions(cm): Width</mat-label>
                        <input matInput formControlName="width" placeholder="Enter Product Width" [readonly]="!editRole">
                        <mat-icon matSuffix>design_services</mat-icon>
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>Dimensions(cm): Height</mat-label>
                        <input matInput formControlName="height" placeholder="Enter Product Height" [readonly]="!editRole">
                        <mat-icon matSuffix>design_services</mat-icon>
                      </mat-form-field>
                    </div>
                    <div class="col-md-6">
                      <mat-form-field appearance="outline">
                        <mat-label>Barcode</mat-label>
                        <input matInput formControlName="barcode" placeholder="barcode" [readonly]="!editRole">
                      </mat-form-field>
                      <mat-form-field appearance="outline">
                        <mat-label>Product Id</mat-label>
                        <input matInput formControlName="product_id" placeholder="barcode" readonly>
                      </mat-form-field>

                      <div class="m-3">
                        <button *ngIf="editRole" [disabled]="!productFormPackaging.dirty" (click)="updatePackaging()" mat-raised-button type="submit" color="primary">Save Packaging</button>  
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </mat-card>
            
          </mat-tab>
          <mat-tab label="Files" *ngIf="canManageThisProduct">
            <div class="mt-5 custom-tab" style="overflow: hidden !important;">
              <div class="row">
                <div class="col-md-4">
                  <mat-card style="background-color: rgb(255, 255, 255);">
                    <div *ngIf="uploadRole">
                      <label>Document Type:</label>
                      <select class="form-control" (change)="setFocusType($event)">
                        <option *ngFor="let type of typesList | typeGroup : 'File'" value="{{ type.id }}">{{ type.name }}</option>
                      </select><br>
                      <label>Document Expiry Date:</label>
                      <input class="form-control" [(ngModel)]="expiry_date" type="date"><br>
                      <input class="form-control" type="file" (change)="onChange($event)" multiple><br>
                      <mat-selection-list #permissions style="background-color: rgb(247, 247, 247);">
                        <mat-list-option style="height: 25px;" *ngFor="let type of typesList | typeGroup : 'File Permission'">
                          {{type.name }}
                        </mat-list-option>
                      </mat-selection-list>
                      <br>
                      <button mat-raised-button color="primary" (click)="uploadDocument('55', 'document')">Upload File</button>
                      <hr>
                      <div class="container" *ngIf="loading">
                        <h3>Loading ...</h3>
                      </div>
                      <div class="progress" style="height:10px;width:100%;">
                        <div class="progress-bar bg-success" [style]="uploadProgressBar"></div>
                      </div>
                      <div *ngIf="messages.length" class="message">
                        <ul *ngFor="let msg of messages; let i = index">
                          <li>{{ msg }}</li>
                        </ul>
                      </div>
                    </div>
                    <div *ngIf="!uploadRole" class="upload-role">
                        <p>You do not have permissions to upload files</p>
                        <mat-icon>upload_file</mat-icon>
                    </div>
                  </mat-card>
                </div>
                <div class="col-md-8">
                  <mat-card style="background-color: rgb(255, 255, 255);">
                    <table class="table">
                      <thead>
                        <tr style="list-style: none;">
                          <th>Document</th>
                          <th>Uploaded</th>
                          <th>Expiry Date</th>
                          <!-- <th>Type</th> -->
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let file of documentFiles" >
                          <td>{{ file.name }}</td>
                          <td>{{ file.created_at | date }}</td>
                          <td>
                            <span *ngIf="today > file.expiry_date">⚠</span>
                            {{ file.expiry_date | date }}
                          </td>
                          <!-- <td>{{ typesList[file.typeGroup].name}}</td> -->
                        </tr>
                  
                      </tbody>
                    </table>
                  </mat-card>
                </div>
              </div>
            </div>
          </mat-tab>
          <!-- <mat-tab label="Briefing Files">
            <div class="mt-5 custom-tab" style="overflow: hidden !important;">
              <div class="row">
                <div class="col-md-4">
                  <mat-card style="background-color: rgb(255, 255, 255);">
                    <div *ngIf="uploadRole">
                      <label>Document Type:</label>
                      <select class="form-control" (change)="setFocusType($event)">
                        <option *ngFor="let type of typesList | typeGroup : 'Briefing File'" value="{{ type.id }}">{{ type.name }}</option>
                      </select><br>
                      <input class="form-control" type="file" (change)="onChange($event)" multiple><br>
                      <mat-selection-list #permissions style="background-color: rgb(247, 247, 247);">
                        <mat-list-option style="height: 25px;" *ngFor="let type of typesList | typeGroup : 'File Permission'">
                          {{type.name }}
                        </mat-list-option>
                      </mat-selection-list>
                      <br>
                      <button mat-raised-button color="primary" (click)="uploadDocument('62', 'document')">Upload Briefing File</button>
                      <hr>
                      <div class="container" *ngIf="loading">
                        <h3>Loading ...</h3>
                      </div>
                      <div class="progress" style="height:10px;width:100%;">
                        <div class="progress-bar bg-success" [style]="uploadProgressBar"></div>
                      </div>
                      <div *ngIf="messages.length" class="message">
                        <ul *ngFor="let msg of messages; let i = index">
                          <li>{{ msg }}</li>
                        </ul>
                      </div>
                    </div>
                    <div *ngIf="!uploadRole" class="upload-role">
                        <p>You do not have permissions to upload briefing files</p>
                        <mat-icon>upload_file</mat-icon>
                    </div>
                  </mat-card>
                </div>
                <div class="col-md-8">
                  <mat-card style="background-color: rgb(255, 255, 255);">
                    <table class="table">
                      <thead>
                        <tr style="list-style: none;">
                          <th>Document</th>
                          <th>Uploaded</th>
                          <th>Expiry Date</th>
                          <th>Permission</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let file of documentFiles" >
                          <td>{{ file.name }}</td>
                          <td>{{ file.created_at | date }}</td>
                          <td>
                            <span *ngIf="today > file.expiry_date">⚠</span>
                            {{ file.expiry_date | date }}
                          </td>
                          <td></td>
                        </tr>
                  
                      </tbody>
                    </table>
                  </mat-card>
                </div>
              </div>
            </div>
          </mat-tab> -->
          <mat-tab label="Media" *ngIf="canManageThisProduct">
            <div class="mt-5 custom-tab" style="overflow: hidden !important;">
              <mat-tab-group>
                <!-- <mat-tab label="Images">
                  <div class="mt-5 custom-tab" style="overflow: hidden !important;">
                    <div class="row">
                      <div class="col-md-3" *ngFor="let image of imageServerFiles; let index = index">
                        <mat-card style="max-width: 280px; margin-bottom: 2rem; background-color: rgb(254, 254, 254);">
                          <div style="height: 120px; width: 130px; overflow: hidden;">
                            <img mat-card-image src="https://images.smdtechnologies.co.za/uploads/{{image.filename}}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" alt="Photo">
                          </div>
                          <mat-card-content>
                            <mat-chip-list aria-label="Fish selection">
                              <mat-chip *ngFor="let type of typesList | typeGroup : 'Image Type'" (click)="downloadImageServer('https://images.smdtechnologies.co.za/uploads/' + image.filename, type.id, image.filename, image)">{{ type.name }}</mat-chip>
                            </mat-chip-list>
                          </mat-card-content>
                          <mat-card-actions class="img-action">
                          </mat-card-actions>       
                        </mat-card>
                      </div>
                      
                    </div>
                  </div>
                </mat-tab> -->
                <mat-tab label="Manage Images">
                  <div class="row py-3">   
                    <div class="col-md-4">
                      <div cdkDropList class="file-list" (cdkDropListDropped)="drop($event)" *ngIf="mediaFiles.length > 0">
                        <div class="file-box" *ngFor="let file of mediaFiles; let i = index">
                          <div class="row" cdkDrag>
                            <div class="col-md-4">
                              <mat-chip-list>
                                <mat-chip color="accent" *ngIf="i == 0" selected>Primary</mat-chip>
                              </mat-chip-list>
                              <span matBadge="{{i+1}}" *ngIf="i > 0" matBadgeOverlap="false" matBadgeColor="accent"></span>
                              <img class="sort-img" alt="{{ file.path }}" src="{{ storageUrl + filePath(file.path) }}">
                            </div>
                            <div class="col-md-8">
                              <mat-form-field appearance="outline" style="width: 90%;">
                                <mat-label>{{ returnTypeName(file.type_id) }}</mat-label>
                                <mat-select>
                                  <mat-option (onSelectionChange)="updateFileType(file.id, type.id)" *ngFor="let type of typesList | typeGroup : 'Image'" value="{{ type.id }}">{{ type.name }}</mat-option>
                                </mat-select>
                              </mat-form-field>
                              <mat-checkbox (click)="ecommerceImage(file.ecommerce, file.id)" [checked]="file.ecommerce == 1">E-commerce {{file.ecommerce}}</mat-checkbox>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-8">
                      <span class="loadingInfo"></span>
                      <div class="row">

                        <div class="col-md-3" style="padding-bottom: 1rem;" *ngFor="let file of mediaFiles">
                          <a style="position: relative; top: 34px;" *ngIf="uploadRole" (click)="deleteFile(file.id)"><mat-icon>delete</mat-icon></a>
                          <img mat-card-image src="{{ storageUrl + filePath(file.path) }}" alt="Photo">
                          <mat-checkbox (click)="addToSelectedFiles(file.id)"></mat-checkbox>
                        </div>

                        <hr>
                        <button *ngIf="selectedFiles.length > 1" mat-raised-button color="warn" (click)="bulkDeleteFiles()">Delete Selected Items</button>
                      </div>
                    </div>
                  </div>
                  <mat-card>
                    <div *ngIf="uploadRole" class="row">
                      <div class="col-md-4 form-border">
                        <input class="form-control" type="file" (change)="onChange($event)" multiple><br>
                        <button mat-raised-button color="primary" (click)="onUpload('47', 'image')">Upload Media</button>
                      </div>
                      <div class="col-md-8">
                        <div class="container" *ngIf="loading">
                          <h3>Loading ...</h3>
                        </div>
                        <div class="progress" style="height:10px;width:100%;">
                          <div class="progress-bar bg-success" [style]="uploadProgressBar"></div>
                        </div>
                        <div *ngIf="messages.length" class="message">
                          <ul *ngFor="let msg of messages; let i = index">
                            <li>{{ msg }}</li>
                          </ul>
                        </div>
                      </div>
                    </div>
      
                    <div *ngIf="!uploadRole" class="row">
                      <div class="col-md-12">
                        <div class="upload-role">
                          <p>You do not have permissions to upload media</p>
                          <mat-icon>hide_image</mat-icon>
                        </div>
                      </div>
                    </div>
      
                  </mat-card>
                </mat-tab>
                <mat-tab label="Videos">
                  <div class="mt-5 custom-tab" style="overflow: hidden !important;">
                    <mat-card>
                      <mat-form-field appearance="outline">
                        <mat-label>New Video Link</mat-label>
                        <input matInput [(ngModel)]="socialLink" placeholder="Enter link here" [readonly]="!editRole">
                        <button mat-flat-button color="primary" (click)="updateSocials('youtu.be')">Save</button>
                      </mat-form-field>

                      <div style="padding: 1rem;">
                        <mat-form-field appearance="legacy" *ngFor="let i of socialLinks">
                          <mat-label>{{ i.link }}</mat-label>
                          <input matInput placeholder="{{i.link}}" [readonly]="true">
                          <mat-icon matSuffix (click)="deleteSocial(i.id, i.link)">delete</mat-icon>
                        </mat-form-field>
                      </div>
                    </mat-card>
                  </div>
                </mat-tab>
              </mat-tab-group>
            </div>
          </mat-tab>

          <mat-tab label="E-commerce View">
            <div class="mt-5 py-3 custom-tab card" style="overflow: hidden !important;">
              <div class="row">
                <div class="col-sm-12 col-md-9 col-lg-7">
                  <table *ngIf="mediaFiles.length > 0">
                    <tr>
                      <td class="img-cell"><img *ngIf="mediaFiles[0] && mediaFiles[0].ecommerce == 1" src="{{ storageUrl + filePath(mediaFiles[0].path) }}" height="66" width="66" (click)="switchImage(0)"></td>
                      <td rowspan="4">
                        <img *ngIf="mediaFiles[0] && mediaFiles[0].ecommerce == 1" src="{{ storageUrl + filePath(mediaFiles[switchImageMain].path) }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" height="350" width="350">
                      </td>
                    </tr>
                    <tr>
                      <td class="img-cell" (click)="switchImage(1)">
                        <img *ngIf="mediaFiles[1] && mediaFiles[1].ecommerce == 1" src="{{ storageUrl + filePath(mediaFiles[1].path) }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" height="66" width="66">
                      </td>
                    </tr>
                    <tr>
                      <td class="img-cell" (click)="switchImage(2)">
                        <img *ngIf="mediaFiles[2] && mediaFiles[2].ecommerce == 1" src="{{ storageUrl + filePath(mediaFiles[2].path) }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" height="66" width="66">
                      </td>
                    </tr>
                    <tr>
                      <td class="img-cell" (click)="switchImage(3)">
                        <img *ngIf="mediaFiles[3] && mediaFiles[3].ecommerce == 1" src="{{ storageUrl + filePath(mediaFiles[3].path) }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" height="66" width="66">
                      </td>
                    </tr>
                  </table>

                  <table *ngIf="mediaFiles.length < 1">
                    <tr>
                      <td class="img-cell"><img src="https://images.smdtechnologies.co.za/uploads/{{ imageServerFiles[0] }}" height="66" width="66" (click)="switchImage(0)"></td>
                      <td rowspan="4">
                        <img src="https://images.smdtechnologies.co.za/uploads/{{ imageServerFiles[1] }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" height="350" width="350">
                      </td>
                    </tr>
                    <tr>
                      <td class="img-cell" (click)="switchImage(1)">
                        <img src="https://images.smdtechnologies.co.za/uploads/{{ imageServerFiles[2] }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" height="66" width="66">
                      </td>
                    </tr>
                    <tr>
                      <td class="img-cell" (click)="switchImage(2)">
                        <img src="https://images.smdtechnologies.co.za/uploads/{{ imageServerFiles[3] }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" height="66" width="66">
                      </td>
                    </tr>
                    <tr>
                      <td class="img-cell" (click)="switchImage(3)">
                        <img src="https://images.smdtechnologies.co.za/uploads/{{ imageServerFiles[4]  }}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" height="66" width="66">
                      </td>
                    </tr>
                  </table>
                </div>
                <div class="col-sm-12 col-md-3 col-lg-5">
                  <small *ngIf="isVerified"><mat-icon style="font-size: 20px;">check_circle</mat-icon> Verified</small>
                  <h2>{{ product.name }}</h2>
                  <p>Brand: {{ productBrand }}</p>
                  <p>{{ product.description }}</p>
                  <ul>
                    <li *ngFor="let i of shoutOuts">{{ i.value }}</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="mt-2 py-3 custom-tab card">
              <h2>Description</h2>
              <p>{{ product.description }}</p>
            </div>

            <div class="mt-2 py-3 custom-tab card">
              <h2>Product Information</h2>
              <table>
                <tr>
                  <td class="table-label-cell">Categories</td>
                  <td>
                      <span *ngFor="let cat of productCategories">{{ cat.name }} <span *ngIf="cat.name != ''"> / </span> </span>
                  </td>
                </tr>
                <tr>
                  <td class="table-label-cell">Brand</td>
                  <td>{{ productBrand }}</td>
                </tr>
                <tr>
                  <td class="table-label-cell">SKU</td>
                  <td>{{ product.sku }}</td>
                </tr>
                <tr>
                  <td class="table-label-cell">Barcode</td>
                  <td>{{ productBarcode }}</td>
                </tr>
                <tr>
                  <td class="table-label-cell">What's in the box</td>
                  <td>
                    <div *ngFor="let i of inTheBox">
                      <span *ngIf="i.key">• {{ i.key }}: </span>
                      <span [innerHTML]="i.value"></span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td class="table-label-cell">Features and Benefits</td>
                  <td>
                    <div *ngFor="let i of featuresAndBenefits">
                      <span *ngIf="i.key">{{ i.key }}: </span>
                      <span [innerHTML]="i.value"></span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td class="table-label-cell">Extended FABs</td>
                  <td>
                    <div *ngFor="let i of extendedFabs">
                      <span *ngIf="i.key">• {{ i.key }}: </span>
                      <span [innerHTML]="i.value"></span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td class="table-label-cell">Attributes</td>
                  <td>
                    <div *ngFor="let i of productAttributes">
                      <span *ngIf="i.key">• {{ i.key }}: </span>
                      <span [innerHTML]="beautifyAttr(i.value)"></span>
                    </div>
                  </td>
                </tr>
              </table>
            </div>

            <div class="mt-2 py-3 custom-tab card">
              <h2>Packaging</h2>
              <div class="row">
                <div class="col-md-12">
                  <mat-progress-bar *ngIf="packagingLoader" color="accent" mode="indeterminate"></mat-progress-bar>
              
                  <table class="table table-bordered mt-2">
                    <tr>
                      <th>Type</th>
                      <th>Length</th>
                      <th>Height</th>
                      <th>Width</th>
                      <th>Weight</th>
                      <th>Barcode</th>
                    </tr>
                    <tr *ngFor="let i of packaging">
                      <td>{{ returnTypeName(i.packaging_type_id) }}</td>
                      <td><input id="length{{i.id}}" matInput placeholder="Length" [value]="i.length" readonly></td>
                      <td><input id="height{{i.id}}" matInput placeholder="Height" [value]="i.height" readonly></td>
                      <td><input id="width{{i.id}}" matInput placeholder="Width" [value]="i.width" readonly></td>
                      <td><input id="weight{{i.id}}" matInput placeholder="Weight" [value]="i.weight" readonly></td>
                      <td><input id="barcode{{i.id}}" matInput placeholder="Barcode" [value]="i.barcode" readonly></td>
                    
                    </tr>
                  </table>
                </div>
              </div>
            </div>

            <div class="mt-2 py-3 custom-tab card">
              <h2>Gallery</h2>
              <div class="row">
                <div class="col-md-3  p-3" *ngFor="let image of imageServerFiles;">
                  <div class="flip-card">
                    <div class="flip-card-inner">
                      <div class="flip-card-front">
                        <p style="font-size:x-small; background-color:rgb(235, 235, 235); color:rgb(165, 165, 165); padding-left: 6px;">Image Server</p>
                        <img mat-card-image src="https://images.smdtechnologies.co.za/uploads/{{image}}" onerror="this.src='https://products.smdtechnologies.com/public/storage/files/default.png'" width="100" >
                      </div>
                      <div class="flip-card-back">
                        <mat-chip-list aria-label="Fish selection">
                          <mat-chip class="mat-chip-list" *ngFor="let type of typesList | typeGroup : 'Image Type'" (click)="downloadImageServer('https://images.smdtechnologies.co.za/uploads/' + image, type.id, image.filename, image)">{{ type.name }}</mat-chip>
                        </mat-chip-list>
                      </div>
                    </div>
                  </div>
                </div>
                
              </div>
            </div>

            <div class="mt-2 py-3 custom-tab card">
              <h2>Videos</h2>

              <div class="row">
                <div *ngFor="let video of videos" class="col-md-6">
                  <iframe width="420" height="315" [src]="video"></iframe>
                </div>
              </div>
              
            </div>
           
          </mat-tab>

        </mat-tab-group>
      </mat-card>
    </div>
    
    <div [class]="infoBarCls" *ngIf="showInfoBar" style="transition: display 1s;">
      <div class="text-muted">
        <mat-card>
          <mat-card-content>
            <div style="text-align: center;">
              <mat-form-field appearance="outline" style="width: 90%;">
                <mat-label><span *ngIf="loadpProductManager">Loading </span>Product Manager</mat-label>
                <mat-select matInput [(value)]="productManagerId" name="productManager" (selectionChange)="selectManager($event)"  [disabled]="!adminRole">
                  <mat-option *ngFor="let user of users" [value]="user.id">{{ user.name + " " + user.surname }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div> 

            <mat-grid-list cols="3" rowHeight="100px">
              <mat-grid-tile colspan="3">
                <mat-progress-spinner
                  [color]="progressPercentage() > 50 ? 'primary' : 'warn'" 
                  [mode]="progressMode"
                  [value]="progressPercentage()">
                </mat-progress-spinner>
              </mat-grid-tile>
            </mat-grid-list>
            <br>
            <div style="text-align: center;">
              <h3>{{ progressPercentage() }}% Complete</h3>
              <small *ngIf="canManageThisProduct">Managed by you</small>
            </div>
            <hr>
            <mat-list role="list" (click)="autoInfo()">
              <mat-list-item role="listitem">
                <mat-icon>check_circle</mat-icon> General Details
              </mat-list-item>
              <mat-list-item role="listitem">
                <mat-icon *ngIf="categoriesList.length < 1">radio_button_unchecked</mat-icon>
                <mat-icon *ngIf="categoriesList.length > 0">check_circle</mat-icon> Categories
              </mat-list-item>
              <mat-list-item role="listitem">
                <mat-icon *ngIf="productAttributes.length < 1 && attributes.length < 1">radio_button_unchecked</mat-icon>
                <mat-icon *ngIf="productAttributes.length > 0 || attributes.length > 0">check_circle</mat-icon> Attributes
              </mat-list-item>
              <mat-list-item role="listitem">
                <mat-icon *ngIf="packagingCount < 1">radio_button_unchecked</mat-icon>
                <mat-icon *ngIf="packagingCount > 0">check_circle</mat-icon> Packaging <span *ngIf="packagingLoading">&nbsp;loading...</span>
              </mat-list-item>
              <mat-list-item role="listitem">
                <mat-icon *ngIf="documentFiles.length < 1">radio_button_unchecked</mat-icon>
                <mat-icon *ngIf="documentFiles.length > 0">check_circle</mat-icon> Documents ({{documentFiles.length}})
              </mat-list-item>
              <mat-list-item role="listitem">
                <mat-icon *ngIf="mediaFiles.length < 1">radio_button_unchecked</mat-icon>
                <!-- <mat-icon *ngIf="mediaFiles.length > 0">check_circle</mat-icon> Images ({{mediaFiles.length + imageServerFiles.length}}) -->
                <mat-icon *ngIf="mediaFiles.length > 0">check_circle</mat-icon> Images ({{mediaFiles.length}})
              </mat-list-item>
            </mat-list>
          </mat-card-content>         
          <div style="text-align: center;">
            <!-- <button mat-raised-button color="primary" (click)="presentation()"><img src="../../../assets/icons/presentation.png" height="40" class="mx-2"> Create Presentation</button> -->
            <qrcode qrdata="https://products.smdtechnologies.com/{{sku}}" [width]="200" [errorCorrectionLevel]="'M'"></qrcode>
          </div>
     
          <mat-card-content style="margin-top: 2rem;">
            <hr>
            <div style="text-align: center; margin-bottom: 1rem;">
              <button mat-raised-button (click)="toggleHistory()">
                <span *ngIf="!historyTable">History</span>
                <span *ngIf="historyTable">Hide history</span>
              </button>
            </div>
            <table *ngIf="historyTable">
              <tr>
                <th>Action</th>
                <th>Date</th>
              </tr>
              <tr *ngFor="let x of audits">
                <td>{{x.activity}}</td>
                <td>{{x.created_at | date: 'dd/MM/yyyy'}}</td>
              </tr>
            </table>
          </mat-card-content>          
        </mat-card>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!product">
  <div *ngIf="!productsLoader">
    <h2>🤷‍♂️ Product code "<strong>{{ sku }}</strong>" does not exist.</h2>
    <p>Please make sure the SKU is correct. If you believe this is the correct product code, please click report this issue.</p>
    <button mat-raised-button color="primary" onclick="alert('Issue reported.')">Report Issue</button>
  </div>
  
</div>
