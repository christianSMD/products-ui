<div *ngIf="!singleBrand">

  <p>Brands</p>

  <mat-tab-group animationDuration="1000ms">
    <mat-tab label="Brands">
      <mat-form-field appearance="legacy" color="primary" style="float: right; margin-right: 1rem;">
          <mat-label>Search</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Search brand, role, etc" #input>
          <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
      <div class="mat-elevation-z8" style="margin-top: 1rem;">
          <mat-progress-bar color="accent" *ngIf="typesLoader == true" mode="indeterminate"></mat-progress-bar>
          <table matTableExporter mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)" #exporter="matTableExporter">
      
            <ng-container matColumnDef="brand">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Brand Name </th>
              <td mat-cell *matCellDef="let row"> <button mat-button (click)="editSingleBrand(row.id, row.name)">{{row.name}}</button> </td>
            </ng-container>
  
            <ng-container matColumnDef="products">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Products </th>
              <td mat-cell *matCellDef="let row">
                 <button mat-button (click)="selectBrand(row.name)">{{countBrandProducts(row.id)}} products</button>
              </td>
            </ng-container>
  
            <ng-container matColumnDef="manager">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Brand Manager </th>
              <td mat-cell *matCellDef="let row">
                  <span *ngIf="loadBrandManager">Loading </span>{{getManager(row.id)}}
              </td>
            </ng-container>
  
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="3">No data matching the filter "{{input.value}}"</td>
            </tr>
          </table>
          <mat-paginator [pageSizeOptions]="[10, 25, 100]" aria-label="Select page of roles"></mat-paginator>
      </div>
    </mat-tab>
  
    <mat-tab label="Manage Brands" [disabled]="!adminRole">
      <mat-form-field appearance="legacy" color="primary" style="float: right; margin-right: 1rem;">
          <mat-label>Search</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Search brand, role, etc" #input>
          <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
      <div class="mat-elevation-z8" style="margin-top: 1rem;">
          <mat-progress-bar color="accent" *ngIf="typesLoader == true" mode="indeterminate"></mat-progress-bar>
          <table matTableExporter mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)" #exporter="matTableExporter">
      
            <ng-container matColumnDef="brand">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Brand Name </th>
              <td mat-cell *matCellDef="let row">
                  <mat-form-field appearance="outline" style="width: 90%; margin-top: 1rem;">
                      <mat-label>Brand</mat-label>
                      <input #brand matInput [value]="row.name" (keyup)="changeName($event, row.id)" placeholder="Enter Brand Name">
                    </mat-form-field>
              </td>
            </ng-container>
  
            <ng-container matColumnDef="products">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>  </th>
              <td mat-cell *matCellDef="let row"></td>
            </ng-container>
  
            <ng-container matColumnDef="manager">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Brand Manager </th>
              <td mat-cell *matCellDef="let row">
                  <mat-form-field appearance="outline" style="width: 90%; margin-top: 1rem;">
                      <mat-label><span *ngIf="loadBrandManager">Loading </span>{{getManager(row.id)}}</mat-label>
                      <mat-select matInput name="brandManager" (selectionChange)="selectUser($event, row.id)">
                          <mat-option *ngFor="let user of users" value="{{user.id}}">{{ user.name + " " + user.surname }}</mat-option>
                      </mat-select>
                  </mat-form-field>
              </td>
            </ng-container>
  
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            <!-- Row shown when there is no matching data. -->
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="3">No data matching the filter "{{input.value}}"</td>
            </tr>
          </table>
          <mat-paginator [pageSizeOptions]="[10, 25, 100]" aria-label="Select page of roles"></mat-paginator>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<div *ngIf="singleBrand">
  <p>Manage {{currentBrand}}</p>
  <div class="row">
    <div class="col-md-4">
      <mat-form-field appearance="outline" style="width: 100%; margin-top: 1rem;">
        <mat-label>Brand Name</mat-label>
        <input #brand matInput [value]="currentBrand" (keyup)="changeName($event, currentId)" placeholder="Enter Brand Name">
      </mat-form-field>
      <br>
        <mat-form-field appearance="outline" style="width: 100%; margin-top: 1rem;">
          <mat-label><span *ngIf="loadBrandManager">Loading </span>{{getManager(currentId)}}</mat-label>
          <mat-select matInput name="brandManager" (selectionChange)="selectUser($event, currentId)">
              <mat-option *ngFor="let user of users" value="{{user.id}}">{{ user.name + " " + user.surname }}</mat-option>
          </mat-select>
          </mat-form-field>
            <div>
              <div *ngIf="uploadRole">
                <hr>
                <label>Document Type:</label>
                <select class="form-control" (change)="setFocusType($event)">
                  <option *ngFor="let type of types | typeGroup : 'File'" value="{{ type.id }}">{{ type.name }}</option>
                </select><br>
                <input class="form-control" type="file" (change)="onChange($event)" multiple><br>
                <mat-selection-list #permissions style="background-color: rgb(247, 247, 247);">
                  <mat-list-option style="height: 25px;" *ngFor="let type of types | typeGroup : 'File Permission'">
                    {{type.name }}
                  </mat-list-option>
                </mat-selection-list>
                <br>
                <button mat-raised-button color="primary" (click)="uploadDocument('62', 'document')">Upload Briefing File</button>
                <hr>
                <div class="container" *ngIf="loading">
                  <h3>Loading ...</h3>
                </div>
                <div class="progress" style="height:10px;width:100%;">
                  <div class="progress-bar bg-success" [style]="uploadProgressBar"></div>
                </div>
                <div *ngIf="messages.length" class="message">
                  <ul *ngFor="let msg of messages; let i = index">
                    <li>{{ msg }}</li>
                  </ul>
                </div>
              </div>
              <div *ngIf="!uploadRole" class="upload-role">
                  <p>You do not have permissions to upload briefing files</p>
                  <mat-icon>upload_file</mat-icon>
              </div>
            </div>
    </div>
    <div class="col-md-8">
      <mat-card style="background-color: rgb(255, 255, 255);">
        <table class="table">
          <thead>
            <tr style="list-style: none;">
              <th>Document</th>
              <th>Uploaded</th>
              <th>Expiry Date</th>
              <!-- <th>Permission</th> -->
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let file of documentFiles" >
              <td>{{ file.name }}</td>
              <td>{{ file.created_at | date }}</td>
              <td>
                <span *ngIf="today > file.expiry_date">âš </span>
                {{ file.expiry_date | date }}
              </td>
              <!-- <td></td> -->
            </tr>
      
          </tbody>
        </table>
      </mat-card>
    </div>
  </div>
</div>






